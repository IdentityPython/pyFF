---
layout: layout
title: "pyFF"
---
        
<div class="content">
   <div class="row"><div class="span12">
<h2>Docker images for pyFF</h2>
<p><a href="https://docker.io">Docker</a> is the best thing since sliced bread and of course pyFF runs on docker. Here is a simple setup for running a metadata aggregator using docker. Below we assume you have a docker setup installed and working. Please refer to the <a href="https://docs.docker.com/">docker documentation</a> for getting started with docker.</p>

<h3>A simple registry</h3>

<p>This creates a simple manual SAML metadata <em>registry</em> - a process which signs and publishes locally sourced SAML metadata. This is very useful if you have a bunch of SPs or IdPs that you need to publish towards external SAML metadata consumers. If you want a UI in front of this, take a look at <a href="https://github.com/Yaco-Sistemas/PEER">PEER from Terena</a> that interfaces nicely with this setup:</p>

<pre><code># docker pull leifj/pyff
# mkdir -p /opt/pyff/metadata
</code></pre>

<p>Next create the following <a href="http://yaml.org">yaml</a> file as <code>/opt/pyff/mdx.fd</code>:</p>

<pre><code>- when update:
    - load:
        - /opt/pyff/metadata
    - break
- when request:
    - select
    - pipe:
        - when accept application/xml:
             - xslt:
                 stylesheet: tidy.xsl
             - first
             - finalize:
                cacheDuration: PT10D
                validUntil: PT5H
             - sign:
                 key: default.key
                 cert: default.crt
             - emit application/xml
             - break
        - when accept application/json:
             - xslt:
                 stylesheet: discojson.xsl
             - emit application/json:
             - break
</code></pre>

<p>Now drop some SAML metadata in <code>/opt/pyff/metadata</code> - as individual files with an <code>.xml</code> extension - and finally start the pyff container:</p>

<pre><code># docker run -e DATADIR=/opt/pyff -v /opt/pyff:/opt/pyff -p 8080:8080
</code></pre>

<p>Now you should be able to point your browser at <code>localhost:8080</code> and you should see your metadata rendered nicely in HTML. If you're missing anything, look for syntax errors in <code>localhost:8080/about</code>. When you're satisfied with the result, point your browser at <code>localhost:8080/role/sp.xml</code> to get a signed SAML aggregate metadata.<p>

<h3>Production Considerations</h3>

<p>In production you could just expose pyFF on port 80 but it is much better to deploy a varnish cache frontend. To do this start pyff without the <code>-p</code> argument and add a varnish frontend:</p>

<pre>
# docker pull leifj/varnish
# docker run -e DATADIR=/opt/pyff -v /opt/pyff:/opt/pyff -n pyff -d
# docker run -p 80:80 --link pyff:backend leifj/varnish
</pre>

<p>Now you can point your customers to <code>https://your.site/role/sp.xml</code> and they will get signed and nicely cached metadata. Miller time!</p>

   </div></div>
</div>
